{% load static %}
<!doctype html>
<html lang="en">

<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-N92XCFB');</script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Browser tap settings -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 5 100 100%22><text y=%22.9em%22 font-size=%2280%22>üöó</text></svg>">
  <title>–ù–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç: –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç</title>

  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <!-- MomentJS core JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <STYLE>A {text-decoration: none;} </STYLE>
</head>

<body class="bg-light">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N92XCFB"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="container">

    <!-- Container 1: Description -->
    <div class="container">
      <div class="text-center">
        <div style="font-size:5rem; width:100%; text-align:center;">
          <a href="/">üöó</a>
        </div>
        <h1>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç</h1>
      </div>
    </div>

    <!-- Container 2: Information about IR calculation -->
    <div class="container my-4 pt-4">
      <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ —Ä–∞—Å—á—ë—Ç</h5>
      <ul id="ir_calculation_info">
        <li>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: <code id="ir_calculation_id_code">{{ ir_calculation_id }}</code></li>
      </ul>
    </div>

    <div class="d-none" id="ir_calculation_info_container">

      <!-- Container 2: Input fields: loan details -->
      <div class="container mt-4 pt-4">
        <div class="row">
          <div class="col-md-4 col-sm-12 mb-4">
            <h5>1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–µ–¥–∏—Ç–∞</h5>
            <div class="mb-2">
              <label for="loan_details__amount" class="form-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞, UAH:</label>
              <input type="number" class="form-control" id="loan_details__amount" min="0" placeholder="150000" step="1000">
            </div>
            <div class="mb-2">
              <label for="loan_details__term" class="form-label">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞, –º–µ—Å—è—Ü–µ–≤:</label>
              <input type="number" class="form-control" id="loan_details__term" min="0" placeholder="36" step="1">
            </div>
            <div class="mb-2" id="loan_details__monthly_payment__div">
              <label for="loan_details__monthly_payment" class="form-label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É, UAH</label>
              <input type="number" class="form-control" id="loan_details__monthly_payment" placeholder="-1" disabled>
            </div>
          </div>
        </div>
      </div>

      <!-- Container 3: Input fields: income -->
      <div class="container pt-4">
        <div class="row">
          <div class="col-md-10 col-sm-12 mb-4">
            <h5>2. –î–æ—Ö–æ–¥—ã</h5>
            <div class="row">

              <!-- Subcontainer 1: Client income -->
              <div class="col-md-5 pt-2">
                <h6>2.1. –î–æ—Ö–æ–¥ –ö–ª–∏–µ–Ω—Ç–∞</h6>
                <div class="mb-2">
                  <label for="income_details__client__total" class="form-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__client__total" min="0" placeholder="20000" step="1000">
                </div>
                <div class="mb-2">
                  <label for="income_details__client__confirmed" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∂—ë–Ω–Ω—ã–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__client__confirmed" min="0" placeholder="5000" step="1000">
                </div>
                <div class="mb-2">
                  <label for="income_details__client__unconfirmed" class="form-label">–ù–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__client__unconfirmed" placeholder="-" disabled>
                </div>
                <div class="mb-2">
                  <label for="income_details__client__unconfirmed_type" class="form-label">–í–∏–¥ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞:</label>
                  <select class="form-select form-select-sm mb-1" id="income_details__client__unconfirmed_type" style="height: 2.5rem;">
                    <option value="-1" selected>–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                    <option value="1" unconfirmed_type_id="1" unconfirmed_type_coef="1.0">–ó–ü –≤ –∫–æ–Ω–≤–µ—Ä—Ç–µ</option>
                    <option value="2" unconfirmed_type_id="2" unconfirmed_type_coef="1.0">–ù–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∑–∞ –æ—Å–Ω–æ–≤–Ω—ã–º –º–µ—Å—Ç–æ–º —Ä–∞–±–æ—Ç—ã</option>
                    <option value="3" unconfirmed_type_id="3" unconfirmed_type_coef="1.0">–î–æ—Ö–æ–¥ –æ—Ç —Å–¥–∞—á–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –∞—Ä–µ–Ω–¥—É</option>
                    <option value="4" unconfirmed_type_id="4" unconfirmed_type_coef="1.0">–î–∏–≤–∏–¥–µ–Ω–¥—ã</option>
                  </select>
                </div>
              </div>

              <!-- Subcontainer 2: Spouse income -->
              <div class="col-md-5 pt-2">
                <h6>2.2. –î–æ—Ö–æ–¥ –ñ–µ–Ω—ã –∏–ª–∏ –ú—É–∂–∞</h6>
                <div class="mb-2">
                  <label for="income_details__spouse__total" class="form-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__spouse__total" min="0" placeholder="20000" step="1000">
                </div>
                <div class="mb-2">
                  <label for="income_details__spouse__confirmed" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∂—ë–Ω–Ω—ã–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__spouse__confirmed" min="0" placeholder="5000" step="1000">
                </div>
                <div class="mb-2">
                  <label for="income_details__spouse__unconfirmed" class="form-label">–ù–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –¥–æ—Ö–æ–¥, UAH:</label>
                  <input type="number" class="form-control" id="income_details__spouse__unconfirmed" placeholder="-" disabled>
                </div>
                <div class="mb-2">
                  <label for="income_details__spouse__unconfirmed_type" class="form-label">–í–∏–¥ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞:</label>
                  <select class="form-select form-select-sm mb-1" id="income_details__spouse__unconfirmed_type" style="height: 2.5rem;">
                    <option value="-1" selected>–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                    <option value="1" unconfirmed_type_id="1" unconfirmed_type_coef="1.0">–ó–ü –≤ –∫–æ–Ω–≤–µ—Ä—Ç–µ</option>
                    <option value="2" unconfirmed_type_id="2" unconfirmed_type_coef="1.0">–ù–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∑–∞ –æ—Å–Ω–æ–≤–Ω—ã–º –º–µ—Å—Ç–æ–º —Ä–∞–±–æ—Ç—ã</option>
                    <option value="3" unconfirmed_type_id="3" unconfirmed_type_coef="1.0">–î–æ—Ö–æ–¥ –æ—Ç —Å–¥–∞—á–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –∞—Ä–µ–Ω–¥—É</option>
                    <option value="4" unconfirmed_type_id="4" unconfirmed_type_coef="1.0">–î–∏–≤–∏–¥–µ–Ω–¥—ã</option>
                  </select>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- Container 4: Input fields: expenses -->
      <div class="container pt-4">
        <div class="row">
          <div class="col-md-10 col-sm-12 mb-4">
            <h5>3. –†–∞—Å—Ö–æ–¥—ã</h5>
            <div class="col-md-5 pt-2">
              <div class="mb-2">
                <label for="expenses_details__rent" class="form-label">–ê—Ä–µ–Ω–¥–∞ –∂–∏–ª—å—è, UAH:</label>
                <input type="number" class="form-control" id="expenses_details__rent" min="0" placeholder="10000" step="1000">
              </div>
              <div class="mb-2">
                <label for="expenses_details__existing_loans" class="form-label">–ü–ª–∞—Ç–µ–∂–∏ –ø–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∫—Ä–µ–¥–∏—Ç–∞–º, UAH:</label>
                <input type="number" class="form-control" id="expenses_details__existing_loans" min="0" placeholder="5000" step="1000">
              </div>
              <div class="mb-2">
                <label for="expenses_details__family_members_count" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏:</label>
                <input type="number" class="form-control" id="expenses_details__family_members_count" min="0" placeholder="1" step="1">
              </div>
              <div class="mb-2">
                <label for="expenses_details__living_city" class="form-label">–ì–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –ö–ª–∏–µ–Ω—Ç–∞:</label>
                <select class="form-select form-select-sm mb-1" id="expenses_details__living_city" style="height: 2.5rem;">
                  <option value="-1" selected>–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                  <option value="1" living_city_id="1" family_member_expenses="4500">–≥. –ö–∏–µ–≤</option>
                  <option value="2" living_city_id="2" family_member_expenses="4000">–ö–∏–µ–≤—Å–∫–∞—è –æ–±–ª.</option>
                  <option value="3" living_city_id="3" family_member_expenses="4000">–≥. –î–Ω–µ–ø—Ä</option>
                  <option value="4" living_city_id="4" family_member_expenses="4000">–≥. –•–∞—Ä—å–∫–æ–≤</option>
                  <option value="5" living_city_id="5" family_member_expenses="4000">–≥. –û–¥–µ—Å—Å–∞</option>
                  <option value="6" living_city_id="6" family_member_expenses="4000">–≥. –õ—å–≤–æ–≤</option>
                  <option value="7" living_city_id="7" family_member_expenses="3500">–î—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</option>
                </select>
              </div>
              <button class="btn btn-primary btn-lg btn-block" type="submit" id="evaluate" style="width: 100%; margin-top: 10px;">–†–∞—Å—á–∏—Ç–∞—Ç—å <br/> –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Container 5: IR Calcution results -->
      <div class="container mb-4 pt-4">
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4">
            <h5>4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞</h5>
            <div>
              <p><span class="badge d-none text-wrap" id="evaluation_statusmessage" style="font-size: 0.9rem;"></span></p>
              <div class="spinner-border d-none" role="status" id="evaluation_statusspinner"></div>  
            </div>
            <p>IR –ö–ª–∏–µ–Ω—Ç–∞: <code id="result_ir">---</code></p>
            <p>–†–µ—à–µ–Ω–∏–µ –ø–æ –∫—Ä–µ–¥–∏—Ç—É: <code id="decision">---</code></p>
            <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: <code id="decision_comment">---</code></p>
          </div>
        </div>
      </div>

    </div>

    <!-- Container 8: Footer -->
    <footer class="mt-5 pt-5 text-muted text-center text-small">
      <p class="mb-1">&copy; 2021 –§–∞—Å—Ç–§—ñ–Ω–∞–Ω—Å</p>
      <ul class="list-inline">
        <li class="list-inline-item"><a href="tel:+380689389889">+38 068 938-98-89</a></li>
        <li class="list-inline-item"><a href="mailto:info@fastfinance.com.ua">info@fastfinance.com.ua</a></li>
      </ul>
    </footer>

  </div>

  <!-- jQuery JavaScript -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

  <!-- Custom JavaScript scripts -->

  <script>
    function customized_round(x) {
      return Number((x).toFixed(0)).toLocaleString()
      // return Number.parseFloat(x).toFixed(2);
    }

    // Set up info about current IR calculations
    $(document).ready(function () {
      $.ajax({
        url: "../../api/ir_picking/calculation/?ir_calculation_id=" + parseInt($('#ir_calculation_id_code').text()),
        type: 'GET',
        dataType: 'json',
        complete: function (res) {
          // display debugging info
          console.log(res.responseJSON);

          // fill IR calculation info
          res = res.responseJSON;

          if (res['status'] === 'ok') {
            let ir_calculation_create_time = res['result'][0];
            let ir_calculation_payload = res['result'][1];

            $('#ir_calculation_info').append(
              '<li>' +
                '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—á—ë—Ç–∞: <code>' + moment(ir_calculation_create_time).format('DD.MM.YYYY HH:mm') + '</code>' +
              '</li>'
            )

            $('#ir_calculation_info_container').removeClass('d-none')

            // fill fields
            let loan_details = ir_calculation_payload['inputs']['loan_details']
            $('#loan_details__amount').val(loan_details['amount'])
            $('#loan_details__term').val(loan_details['term'])
            $('#loan_details__monthly_payment').val(loan_details['monthly_payment'])

            let income_details = ir_calculation_payload['inputs']['income_details'];
            //
            $('#income_details__client__total').val(income_details['client']['total']);
            $('#income_details__client__confirmed').val(income_details['client']['confirmed']);
            $('#income_details__client__unconfirmed').val(income_details['client']['unconfirmed']);
            $('#income_details__client__unconfirmed_type').val(income_details['client']['unconfirmed_type_id']);
            //
            $('#income_details__spouse__total').val(income_details['spouse']['total']);
            $('#income_details__spouse__confirmed').val(income_details['spouse']['confirmed']);
            $('#income_details__spouse__unconfirmed').val(income_details['spouse']['unconfirmed']);
            $('#income_details__spouse__unconfirmed_type').val(income_details['spouse']['unconfirmed_type_id']);

            let expenses_details = ir_calculation_payload['inputs']['expenses_details']
            $('#expenses_details__rent').val(expenses_details['rent'])
            $('#expenses_details__existing_loans').val(expenses_details['existing_loans'])
            $('#expenses_details__family_members_count').val(expenses_details['family_members_count'])
            $('#expenses_details__living_city').val(expenses_details['living_city_id'])

            $('#result_ir').text( Number(ir_calculation_payload['evaluations']['ir'] * 100.0).toFixed(2) + '%' )
            
            let decision_value = ir_calculation_payload['evaluations']['decision'];
            if (decision_value === 'Reject') {
              $('#decision').text( '–û—Ç–∫–∞–∑ –≤ –≤—ã–¥–∞—á–µ –∫—Ä–µ–¥–∏—Ç–∞' )
            } else {
              $('#decision').text( '–û–¥–æ–±—Ä–µ–Ω–∏–µ –≤ –≤—ã–¥–∞—á–µ –∫—Ä–µ–¥–∏—Ç–∞' )
            }
            
            let decision_comment_value = ir_calculation_payload['evaluations']['suggestion'];
            let decision_to_display = '';
            if (decision_comment_value.includes('Add Spouse')) {
              decision_to_display += '–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ö–ª–∏–µ–Ω—Ç—É –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥—ã –ñ–µ–Ω—ã –∏–ª–∏ –ú—É–∂–∞. ';
            }
            if (decision_comment_value.includes('Decrease Loan Amount')) {
              let loan_decrease = ir_calculation_payload['evaluations']['loan_decrease']
              decision_to_display += '–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–º–µ–Ω—à–∏—Ç—å —Å—É–º–º—É –ö—Ä–µ–¥–∏—Ç–∞ –¥–æ ' + customized_round(loan_decrease) + ' –≥—Ä–Ω. ';
            }
            $('#decision_comment').text(decision_to_display);

          } else {
            $('#ir_calculation_info').append(
              '<li class="text-danger">' +
                '<h4>–†–∞—Å—á—ë—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</h4>' +
              '</li>'
            )
          }
        }
      });
    });
  </script>

</body>

</html>
